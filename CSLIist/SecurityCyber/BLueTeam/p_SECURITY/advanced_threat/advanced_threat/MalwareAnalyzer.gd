# res://security360/advanced_threat/MalwareAnalyzer.gd
class_name MalwareAnalyzer
extends SecurityModule

var malware_signatures = [
    "X5O!P%@AP[4\\PZX54(P^)7CC)7}$",
    "malware_init",
    "disable_firewall"
]

var logger = null

func _init():
    logger = preload("res://security360/core/Logger.gd").new()

func start():
    logger.info("ğŸ¦  [MalwareAnalyzer] ÄÃ£ khá»Ÿi Ä‘á»™ng.")
    Security360.events.connect("event", self, "_on_event")

func _on_event(event_type: String, data: Dictionary):
    if event_type == "FILE_UPLOAD":
        _analyze_file(data.file_content, data.filename)

func _analyze_file(content: String, filename: String):
    for sig in malware_signatures:
        if content.find(sig) != -1:
            logger.critical("ğŸ¦  [MalwareAnalyzer] PhÃ¡t hiá»‡n mÃ£ Ä‘á»™c trong file: %s" % filename)
            Security360.events.emit("MALWARE_DETECTED", {
                filename: filename,
                signature: sig,
                source: "static_analysis"
            })
            return

func stop():
    logger.info("ğŸ›‘ [MalwareAnalyzer] ÄÃ£ táº¯t.")