<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Resource Docs</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      display: flex;
    }
    .sidebar {
      width: 280px;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      background-color: #fff;
      border-right: 1px solid #e9ecef;
      padding: 1rem 0;
      overflow-y: auto;
      z-index: 1000;
    }
    .sidebar-header {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid #e9ecef;
      font-weight: 600;
      color: #495057;
      font-size: 1.2rem;
    }
    .nav-topic {
      padding: 0.75rem 1.5rem;
      color: #495057;
      text-decoration: none;
      display: block;
      border-left: 3px solid transparent;
      transition: all 0.2s;
      cursor: pointer;
    }
    .nav-topic:hover {
      background-color: #f8f9fa;
      border-left-color: #0d6efd;
      color: #0d6efd;
    }
    .nav-topic.active {
      background-color: #e7f3ff;
      border-left-color: #0d6efd;
      color: #0d6efd;
      font-weight: 500;
    }
    .main-content {
      margin-left: 280px;
      width: calc(100% - 280px);
      min-height: 100vh;
    }
    .navbar {
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      background-color: #fff;
      border-bottom: 1px solid #e9ecef;
    }
    .navbar-brand {
      font-weight: 600;
    }
    .card {
      transition: transform 0.2s;
      border: 1px solid #e9ecef;
      height: 100%;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .tag {
      font-size: 0.8rem;
      background: #e9ecef;
      padding: 0.2rem 0.5rem;
      border-radius: 12px;
      margin-right: 0.3rem;
    }
    .search-results {
      color: #6c757d;
      font-size: 0.9em;
      margin-bottom: 1rem;
    }
    .no-result {
      text-align: center;
      color: #6c757d;
      font-style: italic;
      padding: 2rem;
    }
    .topic-section {
      scroll-margin-top: 70px;
    }
    @media (max-width: 768px) {
      .sidebar {
        width: 220px;
      }
      .main-content {
        margin-left: 220px;
        width: calc(100% - 220px);
      }
    }
    @media (max-width: 576px) {
      .sidebar {
        width: 60px;
        padding: 0;
      }
      .sidebar-header, .nav-topic span {
        display: none;
      }
      .sidebar-header {
        padding: 1rem;
      }
      .nav-topic {
        padding: 1rem;
        text-align: center;
        font-size: 1.2rem;
      }
      .main-content {
        margin-left: 60px;
        width: calc(100% - 60px);
      }
    }
  </style>
</head>
<body>

  <!-- Sidebar Navigation -->
  <div class="sidebar">
    <div class="sidebar-header">
      <i class="bi bi-book"></i> <span>Resource Docs</span>
    </div>
    <div id="sidebar-nav"></div>
  </div>

  <!-- Main Content Area -->
  <div class="main-content">
    <!-- Top Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white">
      <div class="container">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        
        <!-- Search Form -->
        <form class="d-flex flex-grow-1 mx-3" onsubmit="return false;">
          <div class="input-group">
            <span class="input-group-text bg-white border-end-0">
              <i class="bi bi-search text-muted"></i>
            </span>
            <input id="searchInput" class="form-control border-start-0 ps-0" type="search" placeholder="Search documentation..." aria-label="Search">
            <button class="btn btn-outline-primary" type="button" onclick="document.getElementById('searchInput').value=''; filterContent();">Clear</button>
          </div>
        </form>

        <div class="d-flex align-items-center">
          <a href="#" class="text-decoration-none text-dark me-3">
            <i class="bi bi-github h4 mb-0"></i>
          </a>
          <a href="#" class="text-decoration-none text-dark">
            <i class="bi bi-question-circle h4 mb-0"></i>
          </a>
        </div>
      </div>
    </nav>

    <!-- Page Content -->
    <div class="container mt-4 px-4" id="content-container">
      <p class="text-center text-muted">Loading resources...</p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // === C·∫§U H√åNH ƒê∆Ø·ªúNG D·∫™N JSON ===
    // Khi ch·∫°y local (file://) ‚Üí kh√¥ng ho·∫°t ƒë·ªông do CORS
    // Khi l√™n GitHub Pages ‚Üí thay b·∫±ng URL c√¥ng khai
    // const JSON_PATH = "https://raw.githubusercontent.com/<your-username>/<your-repo>/main/upload_res/data.json";
    // const JSON_PATH = "{{ url_for('static', filename='../data.json') }}";
    
    let allData = {};
    let allTopics = [];

    // T·∫£i d·ªØ li·ªáu JSON
    async function loadData() {
      try {
        const res = await fetch(JSON_PATH);
        if (!res.ok) throw new Error("Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu");
        allData = await res.json();
        allTopics = Object.keys(allData);
        renderContent();
        buildSidebar();
      } catch (err) {
        document.getElementById("content-container").innerHTML = `
          <div class="alert alert-danger">L·ªói t·∫£i d·ªØ li·ªáu: ${err.message}</div>
        `;
      }
    }

    // T·∫°o sidebar t·ª´ key c·ªßa JSON
    function buildSidebar() {
      const nav = document.getElementById("sidebar-nav");
      nav.innerHTML = '';

      allTopics.forEach(topic => {
        const cleanId = topic.toLowerCase().replace(/\s+/g, '-');
        const link = document.createElement('div');
        link.className = 'nav-topic';
        link.setAttribute('href', `#${cleanId}`);
        link.innerHTML = `<i class="bi bi-folder"></i> <span>${topic}</span>`;
        link.onclick = () => {
          document.querySelectorAll('.nav-topic').forEach(el => el.classList.remove('active'));
          link.classList.add('active');
        };
        nav.appendChild(link);
      });

      // M·∫∑c ƒë·ªãnh active topic ƒë·∫ßu ti√™n
      if (nav.children[0]) nav.children[0].classList.add('active');
    }

    // Render n·ªôi dung
    function renderContent() {
      const container = document.getElementById("content-container");
      container.innerHTML = '';

      allTopics.forEach(topic => {
        const cleanId = topic.toLowerCase().replace(/\s+/g, '-');
        const items = allData[topic];
        const count = items?.length || 0;

        const section = document.createElement('div');
        section.className = 'topic-section';
        section.id = cleanId;

        const h4 = document.createElement('h4');
        h4.className = 'mt-4 text-primary border-bottom pb-1';
        h4.innerHTML = `<i class="bi bi-folder me-2"></i>${topic} (${count})`;
        section.appendChild(h4);

        if (!items || items.length === 0) {
          section.innerHTML += '<p><em>Ch∆∞a c√≥ t√†i nguy√™n.</em></p>';
          container.appendChild(section);
          return;
        }

        const row = document.createElement('div');
        row.className = 'row g-3';
        items.forEach(item => {
          const col = document.createElement('div');
          col.className = 'col-md-6 col-lg-4';
          col.innerHTML = `
            <div class="card h-100" data-name="${(item.name || '').toLowerCase()}" 
                                  data-desc="${(item.description || '').toLowerCase()}"
                                  data-tags="${(item.tags || '').toLowerCase()}">
              <div class="card-body d-flex flex-column">
                <h6 class="card-title">
                  <a href="${item.link || '#'}" target="_blank" class="text-decoration-none text-dark">
                    ${item.name || 'Unnamed'}
                  </a>
                </h6>
                <p class="card-text text-muted small flex-grow-1">${item.description || ''}</p>
                <div class="mt-2">
                  ${(item.tags || '').split(',').map(tag => 
                    `<span class="tag">${tag.trim()}</span>`
                  ).join('')}
                </div>
                <small class="text-muted mt-2">
                  <a href="${item.link || '#'}" target="_blank" class="text-decoration-none">üîó Link</a>
                </small>
              </div>
            </div>
          `;
          row.appendChild(col);
        });
        section.appendChild(row);
        container.appendChild(section);
      });

      // K√≠ch ho·∫°t scroll active
      setTimeout(updateActiveNav, 100);
    }

    // T√¨m ki·∫øm
    function filterContent() {
      const query = document.getElementById("searchInput").value.toLowerCase().trim();
      let found = 0;

      document.querySelectorAll('.topic-section').forEach(sec => {
        const topicMatch = sec.querySelector('h4').innerText.toLowerCase().includes(query);
        let itemMatchCount = 0;

        sec.querySelectorAll('.card').forEach(card => {
          const matches = [
            card.dataset.name,
            card.dataset.desc,
            card.dataset.tags
          ].some(field => field.includes(query));

          card.style.display = matches ? '' : 'none';
          if (matches) itemMatchCount++;
        });

        sec.style.display = (itemMatchCount > 0 || topicMatch) ? '' : 'none';
        if (itemMatchCount > 0) found += itemMatchCount;
      });

      document.querySelector('.search-results')?.remove();
      const navbar = document.querySelector('.navbar');
      const resultMsg = document.createElement('div');
      resultMsg.className = 'search-results';
      resultMsg.innerHTML = `Found <strong>${found}</strong> result(s) for "<strong>${query}</strong>" <a href="#" class="text-decoration-none ms-2" onclick="clearSearch()">Clear search</a>`;
      navbar.parentNode.insertBefore(resultMsg, navbar.nextSibling);
    }

    function clearSearch() {
      document.getElementById("searchInput").value = '';
      filterContent();
    }

    // C·∫≠p nh·∫≠t active khi scroll
    function updateActiveNav() {
      const sections = document.querySelectorAll('.topic-section');
      const navLinks = document.querySelectorAll('.nav-topic');
      
      window.addEventListener('scroll', () => {
        let current = '';
        sections.forEach(section => {
          const sectionTop = section.offsetTop - 100;
          if (window.pageYOffset >= sectionTop) {
            current = section.id;
          }
        });
        
        navLinks.forEach(link => {
          link.classList.remove('active');
          if (link.getAttribute('href') === '#' + current) {
            link.classList.add('active');
          }
        });
      });
    }

    // B·∫Øt ƒë·∫ßu
    document.getElementById("searchInput").addEventListener("input", filterContent);
    window.onload = loadData;
  </script>
</body>
</html>